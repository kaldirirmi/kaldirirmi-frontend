<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="../kal-copyright.html">
<link rel="import" href="../model/loader-pac.html">
<link rel="import" href="../model/login-button.html">
<link rel="import" href="../model/kal-nav-content.html">
<link rel="import" href="../model/kal-tagcloud.html">
<link rel="import" href="../model/ability-chart.html">

<link rel="import" href="./review-related-game.html">
<link rel="import" href="./review-user-vote.html">

<link rel="import" href="./kal-review-popular.html">
<link rel="import" href="../shared-styles.html">

<dom-module id="kal-selected-review">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
                /* --header-image: url('/frontend/images/nouseradded.jpg'); */
            }

            :host([is-mobile]) #review-page-container #kalparallax {
                height: 210px;
            }

            :host([is-mobile]) #review-page {
                height: auto !important;
            }

            :host([is-mobile]) ability-chart {
                display: none;
            }

            :host([is-mobile]) #review-chart-panel {
                margin: 0;
            }

            app-header {
                --app-header-background-front-layer: {
                    background-image: var(--header-image);
                    background-position: 50% 10%;
                }
            }

            #review-chart-panel {
                margin: 0;
                text-align: center;
                margin-top: -75px;
            }

            #review-chart-panel h1 {
                color: var(--app-theme-color);
                margin: 5px;
                padding: 0;
            }

            #review-page-container #kalparallax {
                /* The image used */
                /* background-image: url('img_parallax.jpg'); */
                /* background-image: var(--header-image); */
                height: 45vh;
                /* background-attachment: fixed;
                background-position: center;
                background-repeat: no-repeat;
                background-size: cover; */
            }

            #review-page-container #kalparallax iron-image {
                width: 100%;
                height: 100%;
            }

            .loader-pac-content {
                position: relative;
                min-height: 300px;
            }

            .loader-pac-content span {
                font-size: 19px;
                font-weight: 300;
                letter-spacing: 1.3px;
                /* margin-top: 150px; */
                /* margin-left: 20px; */
                position: absolute;
                top: 20%;
                width: 100%;
                text-align: center;
            }

            p,
            h1,
            h2,
            h3,
            h4,
            h5,
            ol,
            li {
                color: white;
            }

            #review-page {
                @apply --layout-vertical;
                overflow-y: scroll !important;
                height: calc(100vh - 192px);

            }

            #review-page::-webkit-scrollbar {
                width: 10px !important;
            }

            #review-page::-webkit-scrollbar-thumb {
                background-color: #333;
                border-radius: 5px;
                border: 2px solid #000;
                min-height: 50px;
            }

            #review-page::-webkit-scrollbar-track {
                background-color: #000;
            }

            #review-page-header {
                @apply --layout-horizontal;
                @apply --layout-center;
                background: #222;
                height: 45px;
                padding: 0 30px;
                position: absolute;
                width: 100%;
                @apply --shadow-elevation-12dp;
                border-top: 3px solid #222222;
                border-bottom: 3px solid #222222;
            }

            #review-page-header paper-icon-button {
                --paper-icon-button-ink-color: white;
                color: white;
                margin-right: 10px;
            }

            #review-page-header h1 {
                font-size: 20px;
                pointer-events: none;
                font-weight: normal;
                flex-grow: 2;
                margin: 0 !important;
            }

            /* parallax demo*/

            #review-parallax {
                width: 100%;
                height: calc(100vh - 109px);
            }

            parallax-element::-webkit-scrollbar {
                width: 10px !important;
            }

            parallax-element::-webkit-scrollbar-thumb {
                background-color: #333;
                border-radius: 5px;
                border: 2px solid #000;
                min-height: 50px;
            }

            parallax-element::-webkit-scrollbar-track {
                background-color: #000;
            }

            #reviewcontent {
                width: calc(100% + 2px);
                position: relative;
                z-index: 0;
                box-sizing: border-box;
                min-height: 500px;
                background: #222;
            }

            #reviewcontent #panel {
                position: relative;
                background: var(--app-theme-color);
                color: white;
            }

            #reviewcontent #panel-contents {
                @apply --layout-horizontal;
                width: 100%;
                align-items: center;
            }

            #reviewcontent #options {
                @apply --layout-horizontal;
                @apply --layout-end-justified;
                background: rgba(0, 0, 0, 0.5);
                position: absolute;
                left: 0;
                right: 0;
                padding: 0 10px;
            }

            #reviewcontent #metadata {
                width: 100%;
                @apply --layout-vertical;
                @apply --layout-center-center;
                align-items: flex-start;
            }

            #reviewcontent #metadata h1 {
                @apply --paper-font-common-nowrap;
                margin: 0 0 4px;
                font-size: 32px;
                font-weight: normal;
                pointer-events: none;
            }

            #reviewcontent #metadata h4 {
                margin: 0;
                font-size: 16px;
                font-weight: normal;
                pointer-events: none;
            }

            #reviewcontent #metadata h6 {
                margin: 7px 0 0 0;
                font-size: 12px;
                font-weight: normal;
                pointer-events: none;
            }

            .review-subtitle-container {
                justify-content: space-between;
                display: flex !important;
                padding: 0px 5px;
            }

            .review-subtitle-container .review-subtitle h3 {
                font-family: inherit;
                font-weight: 100;
            }

            .review-subtitle-container .review-release h3,
            h4 {
                font-style: italic;
                font-weight: 100;
            }

            .review-subtitle-container .review-release iron-icon {
                padding-right: 5px;
                color: white;
            }


            .review-description .review-details p {
                font-weight: 100;
                color: white !important;
                font-family: 'Roboto', 'Noto', sans-serif !important;
                font-size: calc(0.45em + 1vmin) !important;

            }


            #review-details-publisher {
                @apply --layout-horizontal;
                width: 100%;
                height: 60px;
                @apply --layout-center;
                justify-content: space-between;
            }

            .review-details-publisher-container {
                @apply --layout-horizontal;
                @apply --layout-center-center;
                color: white;
                flex-flow: row;
            }

            .review-details-publisher-container iron-icon {
                width: 40px;
                height: 40px;
            }

            #review-details-publisher iron-image {
                min-width: 40px;
                height: 40px;
                margin-top: 10px;
                margin-right: 5px;
                margin-left: 5px;
            }

            /* chart style*/

            #jqxbargauge {
                font-family: 'Roboto', 'Noto', sans-serif !important;
                background-color: #222;
            }

            .pb_heading {
                display: flex;
                text-transform: none;
                margin-left: -10px;
                padding: 0;
                font-size: 20px;
                margin-left: 0px;
            }

            .pb_heading .ic_heading {
                padding-top: 18px;
                padding-left: 6px;
            }

            .header-h3 {
                margin: 0 !important;
                margin-bottom: 5px !important;
                padding-left: 5px;
            }

            .header-h3 b {
                font-weight: 500;
                color: var(--app-theme-color);
            }

            #pib_share_face,
            #pib_share_twit {
                opacity: 0.7;
                transition: all linear .2s;
            }

            #pib_share_face:hover {
                cursor: pointer;
                opacity: 1;
            }

            #pib_share_twit:hover {
                opacity: 1;
                cursor: pointer;
            }


            /* MOBİLE FIRST */

            parallax-layers {
                position: relative;
                width: 100%;
                min-height: 37%;
                z-index: -1;
                margin: 0 auto;
            }

            parallax-layers iron-image {
                width: 100%;
                height: 100%;
                background-color: #222;
            }

            #review-page-container {
                height: 100%;
                margin: 0 auto;
                width: 95%;
            }

            #panel-contents {
                height: 40px;
            }

            #options {
                bottom: 40px;
                height: 36px;
            }

            #options #options_share_buttons {
                margin-top: 3px;
            }

            #review-page-header h1 {
                font-size: 13px !important;
            }

            #panel-contents h2 {
                text-overflow: ellipsis;
                padding-left: 10px;
            }

            .review-description {
                display: flex;
                flex-direction: column !important;
                width: 100%;
                box-shadow: 0 24px 38px 3px rgba(0, 0, 0, 0.14), 0 9px 46px 8px rgba(0, 0, 0, 0.12), 0 11px 15px -7px rgba(0, 0, 0, 0.4);
            }

            .review-description .review-details,
            .review-description .review-popular-review {
                width: 95% !important;
                padding-left: 15px !important;
                margin-right: 10px;
            }

            .review-description .review-details {
                z-index: 2;
            }

            .review-subtitle-container .review-subtitle h3 {
                font-size: calc(0.75em + 1vmin) !important;
            }

            /* chart */

            .review-chart-details {
                display: flex;
                flex-direction: column;
                width: 100%;
                background: #222;
                margin-top: 5px;
            }

            .review-chart-details #gamekpdetails {
                z-index: 400;
                width: 100%;
            }


            .review-chart-details #mobile-chart {
                background-color: #222;
                width: 95%;
                color: white !important;
            }

            #mobile-chart .mobilecardheader {
                margin: 0px 16px;
                border-top: 3px solid var(--app-theme-color);
                padding-top: 5px;
                color: var(--app-theme-color);
                @apply --layout-vertical;
                justify-content: center;
            }

            #mobile-chart .mobilecardheader span {
                font-size: calc(1.3em + 1vmin) !important;
                font-weight: bold;
            }

            #mobile-chart .card-content .card-content-column {
                display: flex;
                justify-content: space-between;
                margin: 0px 16px;
            }

            #mobile-chart .card-actions {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            #mobile-chart .card-actions h2 {
                font-weight: 100;
            }

            #mobile-chart .card-actions .pbmobilechartloginbutton {
                background: var(--app-theme-color);
                margin: 0;
                background: var(--app-theme-color);
                font-size: 22px;
                padding: 0px 20px;
            }

            #mobile-chart .card-content .card-content-column:nth-of-type(1) {
                border-bottom: 2px solid #D94306;
            }

            #mobile-chart .card-content .card-content-column:nth-of-type(2) {
                border-bottom: 2px solid #EE9641;
            }

            #mobile-chart .card-content .card-content-column:nth-of-type(3) {
                border-bottom: 2px solid #EEC46E;
            }

            #mobile-chart .card-content .card-content-column:nth-of-type(4) {
                border-bottom: 2px solid #4CAC90;
            }

            #mobile-chart .card-content .card-content-column:nth-of-type(5) {
                border-bottom: 2px solid #09337B;
            }

            #mobile-chart .card-content .card-content-column p {
                font-size: calc(0.8em + 1vmin);
                font-weight: 500;
            }

            #mobile-chart .card-content .card-content-column:nth-of-type(1) p {
                color: #D94306;
            }

            #mobile-chart .card-content .card-content-column:nth-of-type(2) p {
                color: #EE9641;
            }

            #mobile-chart .card-content .card-content-column:nth-of-type(3) p {
                color: #EEC46E;
            }

            #mobile-chart .card-content .card-content-column:nth-of-type(4) p {
                color: #4CAC90;
            }

            #mobile-chart .card-content .card-content-column:nth-of-type(5) p {
                color: #09337B;
            }


            #jqxlistbox {
                width: 0%;
            }

            hr.package-tile {
                color: rgb(221, 201, 230);
                background-color: black;
                width: 100%;
            }

            @media only screen and (min-width: 320px) {}

            @media only screen and (min-width: 360px) {
                #panel-contents {
                    height: 50px;
                }
                #options {
                    bottom: 50px;
                }

            }

            @media only screen and (max-width: 360px) {
                .review-description .review-details iframe {
                    width: 300px;
                    height: 200px;

                }
            }

            @media only screen and (max-width: 481px) {
                .review-description .review-details iframe {
                    width: 350px;
                    height: 220px;
                }
            }

            @media only screen and (min-width: 768px) {
                parallax-layers {
                    min-height: 47% !important;
                }
                #review-page-header h1 {
                    font-size: 16px !important;
                }

                .review-chart-details #mobile-chart {
                    display: none;
                }

            }

            @media only screen and (min-width: 1024px) {
                /* zoom %175 */
                .review-chart-details {
                    @apply --layout-horizontal;
                }

                .review-description {
                    flex-direction: row !important;
                }
                .review-description .review-details {
                    width: 70% !important;
                }
                .review-description .review-popular-review {
                    width: 30% !important;
                }
                .review-description .review-details,
                .review-description .review-popular-review {
                    padding-left: 5px !important;
                }
                .review-subtitle-container .review-subtitle h3 {
                    font-size: calc(0.55em + 1vmin) !important;
                }
                parallax-layers {
                    width: 70% !important;
                    min-height: 60% !important;
                }
                #review-page-container {
                    width: 70%;
                }
                #review-page-header {
                    width: 70% !important;
                    height: calc(2em + 1vmin) !important;
                }
                #review-page-header h1 {
                    font-size: calc(0.5em + 1vmin) !important;
                }
                #panel-contents {
                    height: 45px;
                }
                #options {
                    bottom: 45px;
                    height: 38px;
                }
                #options #options_share_buttons {
                    margin-top: 3px;
                }

            }

            @media only screen and (min-width: 1224px) {
                /* zoom %150 */
                #panel-contents {
                    height: 50px;
                }
                #options {
                    bottom: 50px;
                    height: 41px;
                }
                #options #options_share_buttons {
                    margin-top: 4px;
                }

                /* chart */
                .review-chart-details #gamekpdetails {
                    width: 60%;
                }
            }

            @media only screen and (min-width: 1440px) {
                /* zoom % 125*/
                #panel-contents {
                    height: 60px;
                }
                #options {
                    bottom: 60px;
                    height: 42px;
                }
                #options #options_share_buttons {
                    margin-top: 5px;
                }


            }

            @media only screen and (min-width: 1640px) {
                /* zoom %110*/
                #panel-contents {
                    height: 70px;
                }
                #options {
                    bottom: 70px;
                    height: 43px;
                }
                #options #options_share_buttons {
                    margin-top: 6px;
                }

                /* chart */
                .review-chart-details {
                    margin-bottom: 20px;

                }
                .review-chart-details #review-chart-panel {
                    margin-right: -35px;
                }

            }

            @media only screen and (min-width: 1824px) {
                #panel-contents {
                    height: 80px;
                }
                #options {
                    bottom: 80px;
                    height: 45px;
                }
                #options #options_share_buttons {
                    margin-top: 8px;
                }

            }

            h2 {
                font-size: calc(0.65em + 1vmin) !important;
            }

            h3 {
                font-size: calc(0.55em + 1vmin) !important;
            }

            h4 {
                font-size: calc(0.45em + 1vmin) !important;
            }

            h5 {
                font-size: calc(0.35em + 1vmin) !important;
            }

            h6 {
                font-size: calc(0.25em + 1vmin) !important;
            }

            .review-details img {
                width: 70% !important;
            }

            .pbKeywords {
                opacity: 0.7;
                background-color: var(--app-theme-color);
                color: white;
                font-weight: 100;
                font-size: calc(0.15em + 1vmin);
                text-transform: lowercase;
            }

            .pbKeywords:hover {
                opacity: 1;
            }

            .review-popular-review {
                width: 30%;
                @apply --layout-vertical;
                z-index: 1;
            }

            .review-popular-review .rightside-tagcloud {
                width: 100%;
            }

            .review-popular-review .rightside-popular-review {
                box-shadow: 0 12px 16px 1px rgba(0, 0, 0, 0.14), 0 4px 22px 3px rgba(0, 0, 0, 0.12), 0 6px 7px -4px rgba(0, 0, 0, 0.4);
            }
        </style>

        <iron-ajax id="getselectedreview" url="/h/main?fm=get-review-info&a=[[url]]" handle-as="json" on-response="_onResponse" loading="{{loading}}"></iron-ajax>
        <iron-ajax id="getgamekpinfo" url="/h/main?fm=get-gamekp-info&a=[[reviewinfo.relatedgames]]" handle-as="json" on-response="_onResponseKpInfo"
            loading="{{loading}}"></iron-ajax>

        <iron-form id="formkleine">
            <form action="/h/main" method="post">
                <input type="hidden" name="fm" value="post-kleine-container-reviews" />
                <input type="hidden" id="container" name="container" value="[[reviewinfo.id]]" />
                <input type="hidden" id="kleine" name="kleine" value="[[reviewinfo.viewcount]]" />
            </form>
        </iron-form>

        <app-toolbar class="selected-page-toolbar">
            <div class="navigation">
                <a id="back" href="/reviews">
                    <paper-icon-button icon="icons:arrow-back"></paper-icon-button>
                    <span>Tüm İncelemeler</span>
                </a>
            </div>
        </app-toolbar>

        <div hidden$=[[!loading]] class="loader-pac-content">
            <loader-pac></loader-pac>
            <span>
                İnceleme Getiriyor..
            </span>
        </div>
        <div hidden$="[[loading]]">
            <template is="dom-if" if={{isReview}}>
                <div id="review-page">
                    <kal-nav-content datatable="kalreviews" dataid="[[reviewinfo.id]]"></kal-nav-content>
                    <div id="review-page-container">
                        <div id="kalparallax">
                            <iron-image src="[[reviewinfo.picture]]" sizing="cover" preload fade alt="[[reviewinfo.title]]"></iron-image>
                        </div>
                        <div id="reviewcontent" itemscope itemtype="http://schema.org/Review">
                            <div id="panel">
                                <div id="options">
                                    <div id="options_share_buttons" class="addthis_inline_share_toolbox"></div>
                                </div>
                                <div id="panel-contents">
                                    <h2 itemprop="headline" style="padding-left: 15px; font-weight: 100;">[[reviewinfo.title]]</h2>
                                </div>
                            </div>
                            <div id="review-content-details">
                                <div class="review-chart-details">
                                    <div id="gamekpdetails">
                                        <review-related-game gameid="[[reviewinfo.relatedgames]]"></review-related-game>
                                    </div>
                                    <div class="chart-panel">
                                        <paper-card id="mobile-chart" evelation="4">
                                            <div class="mobilecardheader">
                                                <span>
                                                    [[_remakeGameKP(gamekpinfo)]]
                                                </span>

                                            </div>
                                            <div class="card-content">
                                                <div class="card-content-column">
                                                    <p>Oynanış</p>
                                                    <p>[[gamekpinfo.gameplay]]</p>
                                                </div>

                                                <div class="card-content-column">
                                                    <p>Zorluk</p>
                                                    <p>[[gamekpinfo.difficulty]]</p>
                                                </div>
                                                <div class="card-content-column">
                                                    <p>Grafikler</p>
                                                    <p>[[gamekpinfo.graphics]]</p>
                                                </div>
                                                <div class="card-content-column">
                                                    <p>Hikaye</p>
                                                    <p>[[gamekpinfo.story]]</p>
                                                </div>
                                                <div class="card-content-column">
                                                    <p>Kullanıcı Değerlendirmesi</p>
                                                    <p>[[gamekpinfo.averagevotes]]</p>
                                                </div>
                                            </div>
                                        </paper-card>
                                        <!-- <div id="jqxlistbox"></div> -->
                                        <ability-chart prop=[[sourcekp]]>
                                        </ability-chart>
                                        <div id="review-chart-panel">
                                            <h1>
                                                [[_remakeGameKP(gamekpinfo)]]
                                            </h1>
                                            <!-- <div id='jqxbargauge'></div> -->
                                            <div id="user-vote">
                                                <div hidden$="[[!storedUser.loggedin]]">
                                                    <h3 class="header-h3">Haydi sende
                                                        <b>oyla!</b>
                                                    </h3>
                                                    <review-user-vote gameid="[[gamekpinfo.gameid]]" stored-user=[[storedUser]]></review-user-vote>
                                                </div>
                                                <div hidden$="[[storedUser.loggedin]]">
                                                    <h3 class="header-h3">Oylayabilmek için
                                                        <b>Giriş</b> Yapmalısın</h3>
                                                    <div class="buttons">
                                                        <login-button stored-user={{storedUser}}></login-button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <hr themed-reverse="" class="style-scope package-tile kaldirirmi-profile-forum">
                                <div class="review-subtitle-container">
                                    <div class="review-subtitle">
                                        <h3 itemprop="alternativeHeadline">[[reviewinfo.subtitle]]</h3>
                                    </div>
                                    <div class="review-release">
                                        <h3 itemprop="dateCreated">[[reviewinfo.releasedate]]</h3>
                                    </div>
                                </div>
                                <hr themed-reverse="" class="style-scope package-tile kaldirirmi-profile-forum">
                                <div class="review-description">
                                    <div itemprop="reviewBody" class="review-details">
                                        <p>
                                            [[reviewinfo.details]]
                                        </p>
                                        <hr themed-reverse="" class="style-scope package-tile kaldirirmi-profile-forum">
                                        <div id="review-details-publisher">
                                            <div itemprop="thumbnailUrl" class="review-details-publisher-container">
                                                <iron-image src="https://cdn.kaldirirmi.com/images/user/avatar/default-user-avatar.png" sizing="cover"></iron-image>
                                                <h3 itemprop="publisher">[[reviewinfo.publisher]]</h3>
                                            </div>
                                            <div class="review-details-publisher-container">
                                                <iron-icon icon="image:remove-red-eye"></iron-icon>
                                                <h3>[[reviewinfo.viewcount]]</h3>
                                            </div>

                                        </div>
                                        <hr themed-reverse="" class="style-scope package-tile kaldirirmi-profile-forum" style="color: rgb(221, 201, 230); background-color: black; width: 100%;">
                                    </div>
                                    <div class="review-popular-review">
                                        <div class="rightside-tagcloud">
                                            <kal-tagcloud contenttitle="[[reviewinfo.title]]" contenttable="kalreviews"></kal-tagcloud>
                                        </div>
                                        <div class="rightside-popular-review">
                                            <kal-review-popular currentreview="[[reviewinfo.id]]"></kal-review-popular>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <kal-copyright></kal-copyright>
                    </div>
                </div>
            </template>
            <div hidden$=[[isReview]]>
                <span class="item-is-not-exist">Böyle bir inceleme bulunmamaktadır!</span>
            </div>
        </div>

    </template>

    <script>
        /**
         * `kal-selected-review` Description
         *
         * @summary ShortDescription.
         * @customElement
         * @polymer
         * @extends {Polymer.Element}
         */
        class KalSelectedReview extends Polymer.Element {
            /**
             * String providing the tag name to register the element under.
             */
            static get is() {
                return 'kal-selected-review';
            }

            /**
             * Object describing property-related metadata used by Polymer features
             */
            static get properties() {
                return {
                    url: {
                        type: String,
                        notify: true
                    },
                    isReview: Boolean,
                    reviewinfo: {
                        type: Object,
                        value: null,
                    },
                    gamekpinfo: Object,
                    storedUser: Object,
                    isMobile: {
                        type: Boolean,
                        reflectToAttribute: true
                    },
                    sourcekp: Object,


                };
            }



            static get observers() {
                return [
                    '_selectedReviewChanged(url)'
                ]
            }

            /**
             * Use for one-time configuration of your component after local DOM is
             * initialized.
             */
            ready() {
                super.ready();

                // When possible, use afterNextRender to defer non-critical
                // work until after first paint.
                Polymer.RenderStatus.afterNextRender(this, function () {
                    // console.log('ready', this.url)
                    this.$.formkleine.submit();
                });

            }

            /**
             * An attribute was added, removed, updated, or replaced. Also called for
             * initial values when an element is created by the parser, or upgraded.
             * Note: only attributes listed in the observedAttributes property will
             * receive this callback. 
             */
            attributeChangedCallback(attrName, oldVal, newVal) {
                // console.log('attributeChangedCallback', attrName);
            }

            /**
             * Called every time the element is inserted into the DOM. Useful for 
             * running setup code, such as fetching resources or rendering.
             * Generally, you should try to delay work until this time.
             */
            connectedCallback() {
                super.connectedCallback();

                // console.log('connectedCallback', this.url)

            }

            /**
             * Instance of the element is created/upgraded. Useful for initializing
             * state, set up event listeners, create shadow dom.
             * @constructor
             */
            constructor() {
                super();
                // console.log('constructor', this.url)
            }

            _selectedReviewChanged(newVal, oldVal) {
                // we are starting here..
                this._clearState();
                this._debounceWork();
                // console.log('CurrentUrl: ', newVal, oldVal);
            }

            _onResponse(event) {
                var response = event.detail.response;

                // console.log('kal-selected-review response: ', response);

                if (response.id != 0) {
                    this.set('isReview', true);
                    // console.log(response);
                    this.set('reviewinfo', response);
                    this._setMetadata();
                    //generate this for retrieving kp infos
                    this.$.getgamekpinfo.generateRequest();
                } else {
                    var myobj = {
                        details: "Lorem Ipsum Nedir?Lorem Ipsum, dizgi ve baskı endüstrisinde kullanılan mıgır metinlerdir. Lorem Ipsum, adı bilinmeyen bir matbaacının bir hurufat numune kitabı oluşturmak üzere bir yazı galerisini alarak karıştırdığı 1500'lerden beri endüstri standardı sahte metinler olarak kullanılmıştır. Beşyüz yıl boyunca varlığını sürdürmekle kalmamış, aynı zamanda pek değişmeden elektronik dizgiye de sıçramıştır. 1960'larda Lorem Ipsum pasajları da içeren Letraset yapraklarının yayınlanması ile ve yakın zamanda Aldus PageMaker gibi Lorem Ipsum sürümleri içeren masaüstü yayıncılık yazılımları ile popüler olmuştur.Neden Kullanırız?Yinelenen bir sayfa içeriğinin okuyucunun dikkatini dağıttığı bilinen bir gerçektir. Lorem Ipsum kullanmanın amacı, sürekli 'buraya metin gelecek, buraya metin gelecek' yazmaya kıyasla daha dengeli bir harf dağılımı sağlayarak okunurluğu artırmasıdır. Şu anda birçok masaüstü yayıncılık paketi ve web sayfa düzenleyicisi, varsayılan mıgır metinler olarak Lorem Ipsum kullanmaktadır. Ayrıca arama motorlarında 'lorem ipsum' anahtar sözcükleri ile arama yapıldığında henüz tasarım aşamasında olan çok sayıda site listelenir. Yıllar içinde, bazen kazara, bazen bilinçli olarak (örneğin mizah katılarak), çeşitli sürümleri geliştirilmiştir.",
                        category: "inceleme",
                        id: 1000014,
                        picture: "https://cdn.kaldirirmi.com/images/reviews/2550935-forest003.jpg",
                        publisher: "koraayg",
                        publisheravatar: "",
                        relatedgames: "1000048",
                        releasedate: "21.03.2018",
                        searchkeywords: "kaldirirmi,kaldırır,kaldırır mı,inceleme,kaldırırmı incelemeler,popüler incelemeler,oyun incelemeleri,forest oynanış,forest gameplay,forest inceleme",
                        subtitle: "test inceleme",
                        title: "Forest inceleme",
                        url: "forest-inceleme"
                    };
                    // this.set('reviewinfo', myobj);
                    this.set('isReview', false);
                }

            }
            
            
            _setMetadata() {
                var event = new CustomEvent('app-metadata', {
                    bubbles: true,
                    composed: true,
                    detail: {
                        title:  this.reviewinfo.title + ' - kaldirirmi.com',
                        description: 'Kaldirirmi.com - ' + this.reviewinfo.title + ' - ' + this.reviewinfo.subtitle,
                        keywords: this.reviewinfo.searchkeywords,
                        name: this.reviewinfo.title,
                        url: 'https://kaldirirmi.com/reviews/' + this.url,
                        image: this.reviewinfo.picture,
                        author: this.reviewinfo.publisher
                    }
                });
                this.dispatchEvent(event);
            }


            _onResponseKpInfo(event) {
                var response = event.detail.response;

                // console.log('kal-selected-review get kpinfo: ', response);
                if (response !== null) {

                    this.set('gamekpinfo', response);

                    // var game_data = [{
                    //     "id": "1",
                    //     "name": "Oynanış",
                    //     "degree": this.gamekpinfo.gameplay
                    // }, {
                    //     "id": "2",
                    //     "name": "Zorluk",
                    //     "degree": this.gamekpinfo.difficulty
                    // }, {
                    //     "id": "3",
                    //     "name": "Grafikler",
                    //     "degree": this.gamekpinfo.graphics
                    // }, {
                    //     "id": "4",
                    //     "name": "Hikaye",
                    //     "degree": this.gamekpinfo.story
                    // }, {
                    //     "id": "5",
                    //     "name": "Kullanıcı Değerlendirmesi",
                    //     "degree": this.gamekpinfo.averagevotes
                    // }];

                    this.sourcekp = {
                        "dimension": 400,
                        "numLayer": 5,
                        "eachLayerStyle": [{
                                "fillColor": "#D94306",
                                "borderColor": "#222222"
                            },
                            {
                                "fillColor": "#EE9641",
                                "borderColor": "#222222"
                            },
                            {
                                "fillColor": "#EEC46E",
                                "borderColor": "#222222"
                            },
                            {
                                "fillColor": "#4CAC90",
                                "borderColor": "#222222"
                            },
                            {
                                "fillColor": "#09337B",
                                "borderColor": "#222222"
                            }
                        ],
                        "labelFont": "13px Roboto",
                        "labelFontColor": "#fff",
                        "labelOffset": 10,
                        "frameBorderWidth": 1,
                        "chartBorderWidth": 2,
                        "decorLineColor": "#222222",
                        "chartPortion": 0.75,
                        "chartAlpha": 0.95,
                        "scale": {
                            "font": "bold 12px Roboto",
                            "fontColor": "white",
                            "offset": 12,
                            "scaleLabel": ["0", "20", "40", "60", "80", "100"]
                        },
                        "datasets": {
                            "keys": ["Kullanıcı Değerlendirmesi", "Zorluk", "Grafikler", "Hikaye",
                                "Oynanış"
                            ],
                            "values": [
                                [this.gamekpinfo.averagevotes,
                                    this.gamekpinfo.difficulty,
                                    this.gamekpinfo.graphics,
                                    this.gamekpinfo.story,
                                    this.gamekpinfo.gameplay
                                ]
                            ],
                            "styles": [{
                                "borderColor": "#000000"
                            }, {
                                "borderColor": "#000000"
                            }]
                        }
                    };


                    // var game_source = {
                    //     datatype: "json",
                    //     datafields: [{
                    //             name: 'name'
                    //         },
                    //         {
                    //             name: 'degree',
                    //             type: 'int'
                    //         }
                    //     ],
                    //     id: 'id',
                    //     localdata: game_data
                    // };

                    // var game_dataAdapter = new $.jqx.dataAdapter(game_source);
                    // console.log(this.$.jqxlistbox);


                    // this.$.jqxlistbox.jqxListBox({
                    //     width: 10,
                    //     height: 10,
                    //     source: game_dataAdapter,
                    //     displayMember: "name",
                    //     valueMember: "degree",
                    //     checkboxes: true
                    // });

                    // // this.$.jqxlistbox.css('visibility', 'hidden');
                    // this.$.jqxlistbox.style.visibility = "hidden";

                    // this.$.jqxlistbox.jqxListBox('checkIndex', 0);
                    // this.$.jqxlistbox.jqxListBox('checkIndex', 1);
                    // this.$.jqxlistbox.jqxListBox('checkIndex', 2);
                    // this.$.jqxlistbox.jqxListBox('checkIndex', 3);
                    // this.$.jqxlistbox.jqxListBox('checkIndex', 4);

                    // var getValues = function () {
                    //     var items = this.$.jqxlistbox.jqxListBox('getCheckedItems');
                    //     var array = convertToArray(items);
                    //     return array;
                    // };

                    // var convertToArray = function (items) {
                    //     var preparedArray = new Array(items.length);
                    //     for (var i = 0; i < items.length; i += 1) {
                    //         preparedArray[i] = items[i].value;
                    //     }
                    //     return preparedArray;
                    // }

                    // var mean = 69;
                    // this.$.jqxbargauge.jqxBarGauge({
                    //     width: 500,
                    //     height: 400,
                    //     values: getValues(),
                    //     backgroundColor: '#222',
                    //     max: 100,
                    //     relativeInnerRadius: 0.2,
                    //     colorScheme: 'scheme17',
                    //     tooltip: {
                    //         visible: true,
                    //         formatFunction: function (value, index) {
                    //             var items = this.$.jqxlistbox.jqxListBox('getCheckedItems');
                    //             var item = items[index];
                    //             return item.label + ": " + value + '/100 puan';
                    //         }
                    //     },
                    //     labels: {
                    //         formatFunction: function (value) {
                    //             return value + ' puan';
                    //         },
                    //         precision: 0,
                    //         indent: 15,
                    //         connectorWidth: 1
                    //     }
                    // });
                    // this.$.jqxbargauge.on('change', function (event) {
                    //     var value = this.$.jqxbargauge.val();
                    //     var type = event.args.type;
                    // });
                    // var getSum = function (array) {
                    //     array = array || [];
                    //     var sum = 0;
                    //     if (!!array.length) {
                    //         for (var i = 0; i < array.length; i += 1) {
                    //             sum += array[i];
                    //         }
                    //     }
                    //     return sum;
                    // };
                }
            }

            _debounceWork() {
                //Polymer.Async.timeOut.after(400)
                this._debounceJob = Polymer.Debouncer.debounce(
                    this._debounceJob,
                    Polymer.Async.microTask,
                    () => {
                        this._generateRequest();
                    });
            }

            _clearState() {
                this.set('reviewinfo', null);
            }

            _generateRequest() {
                if (this.$.getselectedreview.lastRequest) {
                    this.$.getselectedreview.lastRequest.abort();
                }
                this.$.getselectedreview.generateRequest();
            }

            // _getRelatedGame(reviewinfo) {
            //     console.log(reviewinfo);

            //     return reviewinfo.relatedgames.split(',')[0];
            // }

            _remakeGameKP(gamekpinfo) {
                return (gamekpinfo.gameplay + gamekpinfo.graphics + gamekpinfo.story + gamekpinfo.averagevotes) /
                    4 + " KP";
            }

        }

        window.customElements.define(KalSelectedReview.is, KalSelectedReview);
    </script>
</dom-module>